<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MobileGit</title>
    
    <!-- PWA MANIFEST LINK -->
    <link rel="manifest" href="manifest.json">

    <!-- APP ICONS -->
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- iOS PWA SETTINGS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">

    <!-- 1. Tailwind & Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 950: '#0f172a' }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            min-height: 100vh;
        }
        .loader { border: 3px solid rgba(128,128,128,0.3); border-radius: 50%; border-top: 3px solid #3b82f6; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        textarea, input { font-size: 16px !important; }
        
        #error-box { display: none; margin: 20px; padding: 15px; background: #fee2e2; border: 1px solid #ef4444; color: #b91c1c; border-radius: 8px; font-family: monospace; word-break: break-all; }
        html.dark #error-box { background: #7f1d1d; color: #fecaca; }
        
        /* Modal Backdrop */
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        html.dark .modal-bg { background: rgba(0,0,0,0.8); }

        /* Menu Position */
        .menu-dropdown { position: absolute; top: 60px; right: 10px; width: 220px; z-index: 60; }
    </style>

    <!-- 2. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 text-slate-900 dark:bg-slate-950 dark:text-f1f5f9 transition-colors duration-200">

    <div id="loading-ui" class="text-center p-10 text-slate-500">
        <div class="loader"></div>
        <p>Initializing...</p>
        <button onclick="localStorage.clear(); window.location.reload()" class="mt-8 text-xs text-blue-500 underline">Reset App Data</button>
    </div>

    <div id="error-box"></div>
    <div id="root"></div>

    <!-- 3. SCRIPT -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from "https://esm.sh/react@18.2.0";
        import { createRoot } from "https://esm.sh/react-dom@18.2.0/client";
        import { Octokit } from "https://esm.sh/@octokit/rest@20.0.1";

        // --- CONFIGURATION ---
        const GITHUB_CLIENT_ID = "Ov23liwbmxvn9qmImYMZ"; 
        const GAS_PROXY_URL = "https://script.google.com/macros/s/AKfycbw83udtxsHNQ2bnJLikBePT6QM3-hkNWf-8Rci7QhXPYQAasSLEo_snW0n1uK6SQDaY/exec"; 
        
        // --- ICONS ---
        const Icons = {
            Folder: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-500 dark:text-blue-400 w-6 h-6"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></svg>,
            File: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-emerald-600 dark:text-emerald-400 w-6 h-6"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Back: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 text-gray-500 dark:text-gray-300"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            Save: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Logout: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
            Git: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5"><circle cx="12" cy="12" r="3"/><line x1="12" x2="12" y1="3" y2="9"/><line x1="12" x2="12" y1="15" y2="21"/></svg>,
            Private: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline w-3 h-3 mb-0.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Zap: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>,
            Globe: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Copy: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>,
            Paste: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>,
            Menu: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>,
            Refresh: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            Update: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        };

        function App() {
            // Theme State
            const [theme, setTheme] = useState(localStorage.getItem("theme") || "dark");

            // Apply Theme Effect
            useEffect(() => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                localStorage.setItem("theme", theme);
            }, [theme]);

            const toggleTheme = () => {
                setTheme(theme === 'dark' ? 'light' : 'dark');
            };

            const [token, setToken] = useState(localStorage.getItem("gh_token"));
            const [view, setView] = useState("repos");
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            
            // Data
            const [repos, setRepos] = useState([]);
            const [files, setFiles] = useState([]);
            const [currentRepo, setCurrentRepo] = useState(null);
            const [path, setPath] = useState("");
            
            // Editor
            const [fileContent, setFileContent] = useState("");
            const [fileSha, setFileSha] = useState("");
            const [filePath, setFilePath] = useState("");
            const [commitMsg, setCommitMsg] = useState("Update via MobileGit");

            // UI State
            const [modalMode, setModalMode] = useState(null); 
            const [inputName, setInputName] = useState("");
            const [showGlobalMenu, setShowGlobalMenu] = useState(false);

            // Hide Loading UI
            useEffect(() => {
                const loader = document.getElementById('loading-ui');
                if(loader) loader.style.display = 'none';
            }, []);

            // Auth Logic
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get("code");
                const REDIRECT_URI = window.location.href.split('?')[0];

                if (code && !token) {
                    setLoading(true);
                    window.history.replaceState({}, document.title, REDIRECT_URI);
                    
                    fetch(`${GAS_PROXY_URL}?code=${code}`)
                        .then(res => res.json())
                        .then(data => {
                            if (data.access_token) {
                                localStorage.setItem("gh_token", data.access_token);
                                setToken(data.access_token);
                            } else {
                                throw new Error(JSON.stringify(data));
                            }
                        })
                        .catch(err => setError(err.message))
                        .finally(() => setLoading(false));
                }
            }, [token]);

            const octokit = useMemo(() => {
                if(!token) return null;
                return new Octokit({ auth: token });
            }, [token]);

            // --- AUTH ---
            const login = () => {
                const REDIRECT_URI = window.location.href.split('?')[0];
                window.location.href = `https://github.com/login/oauth/authorize?client_id=${GITHUB_CLIENT_ID}&redirect_uri=${REDIRECT_URI}&scope=repo,delete_repo`;
            };

            const logout = () => {
                localStorage.removeItem("gh_token");
                setToken(null);
                setRepos([]);
                setView("repos");
                setError(null);
                setShowGlobalMenu(false);
            };

            // --- DATA LOADING & REFRESH ---
            const loadRepos = async () => {
                if(!octokit) return;
                setLoading(true);
                setError(null);
                try {
                    const res = await octokit.repos.listForAuthenticatedUser({ sort: "updated", per_page: 30 });
                    setRepos(res.data);
                    setView("repos");
                } catch(e) { 
                    if (e.status === 401) logout();
                    else setError("Failed to load repos: " + e.message);
                }
                setLoading(false);
            };

            const loadFiles = async (repo, dir = "") => {
                setLoading(true);
                setError(null);
                try {
                    const res = await octokit.repos.getContent({ owner: repo.owner.login, repo: repo.name, path: dir });
                    const data = Array.isArray(res.data) ? res.data : [res.data];
                    data.sort((a, b) => (b.type === "dir" ? 1 : 0) - (a.type === "dir" ? 1 : 0));
                    setFiles(data);
                    setCurrentRepo(repo);
                    setPath(dir);
                    setView("files");
                } catch(e) { setError("Could not open folder."); }
                setLoading(false);
            };

            const openFile = async (file) => {
                setLoading(true);
                setError(null);
                try {
                    const res = await octokit.repos.getContent({ owner: currentRepo.owner.login, repo: currentRepo.name, path: file.path });
                    if (!res.data.content) throw new Error("File empty/large");
                    
                    const binaryString = atob(res.data.content.replace(/\n/g, ""));
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i);
                    const content = new TextDecoder().decode(bytes);

                    setFileContent(content);
                    setFileSha(res.data.sha);
                    setFilePath(file.path);
                    setView("editor");
                } catch(e) { setError("Cannot read file (Binary/Large)"); }
                setLoading(false);
            };

            useEffect(() => { if(token) loadRepos(); }, [token, octokit]);

            // --- GLOBAL ACTIONS ---
            const handleRefreshData = async () => {
                setShowGlobalMenu(false);
                if (view === 'repos') await loadRepos();
                else if (view === 'files') await loadFiles(currentRepo, path);
                else if (view === 'editor') {
                    if (confirm("Reload file? Unsaved changes will be lost.")) {
                        await openFile({ path: filePath });
                    }
                }
            };

            const handleForceUpdateApp = () => {
                if(confirm("Reload the app code?")) {
                    window.location.reload();
                }
            };

            // --- CREATION ---
            const handleCreate = async () => {
                if(!inputName) return;
                
                if (modalMode === 'repo') {
                    setLoading(true);
                    try {
                        await octokit.repos.createForAuthenticatedUser({ name: inputName, auto_init: true });
                        setInputName("");
                        setModalMode(null);
                        await loadRepos();
                    } catch(e) { alert("Create failed: " + e.message); }
                    setLoading(false);

                } else if (modalMode === 'file') {
                    const fullPath = path ? `${path}/${inputName}` : inputName;
                    setFileContent("");
                    setFileSha(""); 
                    setFilePath(fullPath);
                    setCommitMsg(`Create ${inputName}`);
                    setView("editor");
                    setInputName("");
                    setModalMode(null);
                }
            };

            const handleKeyDown = (e) => {
                if(e.key === 'Enter') {
                    e.preventDefault();
                    handleCreate();
                }
            };

            const deleteRepo = async (repo, e) => {
                e.stopPropagation();
                const confirmName = prompt(`DANGER: To delete '${repo.name}', type its name below:`);
                if (confirmName !== repo.name) return;

                setLoading(true);
                try {
                    await octokit.repos.delete({ owner: repo.owner.login, repo: repo.name });
                    setRepos(repos.filter(r => r.id !== repo.id));
                } catch(e) { alert("Delete failed. Check permissions."); }
                setLoading(false);
            };

            const enablePages = async (repo, e) => {
                e.stopPropagation();
                setLoading(true);
                try {
                    await octokit.repos.createPagesSite({
                        owner: repo.owner.login,
                        repo: repo.name,
                        source: { branch: 'main', path: '/' }
                    });
                    alert("Pages triggered! Wait 1-2 mins.");
                } catch(e) { 
                    if(e.status === 409) alert("Pages already enabled!"); 
                    else alert("Failed: " + e.message); 
                }
                setLoading(false);
            };

            const launchSite = (repo, e) => {
                e.stopPropagation();
                const url = `https://${repo.owner.login}.github.io/${repo.name}/`;
                window.open(url, '_blank');
            };

            const saveFile = async () => {
                setLoading(true);
                try {
                    const bytes = new TextEncoder().encode(fileContent);
                    let binaryString = "";
                    for (let i = 0; i < bytes.byteLength; i++) binaryString += String.fromCharCode(bytes[i]);
                    const contentEncoded = btoa(binaryString);

                    const payload = {
                        owner: currentRepo.owner.login,
                        repo: currentRepo.name,
                        path: filePath,
                        message: commitMsg,
                        content: contentEncoded
                    };
                    if (fileSha) payload.sha = fileSha;

                    await octokit.repos.createOrUpdateFileContents(payload);
                    alert("Committed!");
                    loadFiles(currentRepo, path);
                } catch(e) { setError("Commit failed: " + e.message); }
                setLoading(false);
            };

            // --- CLIPBOARD ---
            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(fileContent);
                    alert("Copied!");
                } catch (err) { alert("Copy failed: " + err); }
            };

            const handlePaste = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    if(confirm("Overwrite file?")) setFileContent(text);
                } catch (err) { alert("Paste failed. Allow permissions."); }
            };

            // --- RENDER ---
            if (!token) {
                return (
                    <div className="flex flex-col items-center justify-center h-screen p-6 animate-in fade-in bg-gray-50 dark:bg-slate-950">
                        <h1 className="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">MobileGit</h1>
                        <p className="mb-8 text-gray-500 dark:text-gray-400 text-center">Cloud-native mobile editor</p>
                        {error && <div className="bg-red-100 dark:bg-red-900/50 border border-red-500 text-red-700 dark:text-red-200 p-4 rounded mb-6 text-sm">{error}</div>}
                        {loading ? <div className="loader"></div> : 
                            <button onClick={login} className="bg-slate-900 dark:bg-white text-white dark:text-black px-6 py-3 rounded-full font-bold flex items-center gap-2 shadow-lg active:scale-95 transition">
                                <Icons.Git /> Login with GitHub
                            </button>
                        }
                    </div>
                );
            }

            return (
                <div className="pb-20 max-w-3xl mx-auto min-h-screen flex flex-col relative text-slate-900 dark:text-gray-100" onClick={() => { if(showGlobalMenu) setShowGlobalMenu(false); }}>
                    {/* Header */}
                    <div className="sticky top-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur border-b border-gray-200 dark:border-slate-800 p-4 flex items-center justify-between z-50 shadow-sm transition-colors duration-200">
                        <div className="flex items-center gap-3 overflow-hidden">
                            {view !== "repos" && (
                                <button onClick={() => {
                                    if(view === 'editor') setView('files');
                                    else if(view === 'files' && path) loadFiles(currentRepo, path.split('/').slice(0,-1).join('/'));
                                    else loadRepos();
                                }} className="p-2 bg-gray-100 dark:bg-slate-800 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition">
                                    <Icons.Back />
                                </button>
                            )}
                            <h1 className="font-bold truncate text-sm text-slate-900 dark:text-white">
                                {view === "repos" ? "Repositories" : view === "files" ? (path || "/") : filePath}
                            </h1>
                        </div>
                        <div className="flex items-center gap-2">
                            {(view === "repos" || view === "files") && (
                                <button 
                                    onClick={() => { setInputName(""); setModalMode(view === 'repos' ? 'repo' : 'file'); }} 
                                    className="p-2 bg-blue-600 text-white rounded-full active:scale-90 transition"
                                >
                                    <Icons.Plus />
                                </button>
                            )}
                             <button onClick={toggleTheme} className="p-2 bg-gray-100 dark:bg-slate-800 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition">
                                <span className="text-xl">ðŸŒ—</span>
                            </button>
                            <button onClick={(e) => { e.stopPropagation(); setShowGlobalMenu(!showGlobalMenu); }} className="text-gray-500 dark:text-gray-400 p-2 hover:text-slate-900 dark:hover:text-white relative">
                                <Icons.Menu />
                            </button>
                        </div>
                    </div>

                    {/* GLOBAL MENU */}
                    {showGlobalMenu && (
                        <div className="menu-dropdown bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl shadow-2xl p-2 flex flex-col gap-1 animate-in fade-in slide-in-from-top-2">
                            <button onClick={handleRefreshData} className="flex items-center gap-3 p-3 rounded hover:bg-gray-100 dark:hover:bg-slate-700 text-left">
                                <span className="text-blue-500 dark:text-blue-400"><Icons.Refresh /></span>
                                <span className="text-sm text-slate-700 dark:text-gray-200">Refresh Data</span>
                            </button>
                            <button onClick={handleForceUpdateApp} className="flex items-center gap-3 p-3 rounded hover:bg-gray-100 dark:hover:bg-slate-700 text-left">
                                <span className="text-emerald-500 dark:text-green-400"><Icons.Update /></span>
                                <span className="text-sm text-slate-700 dark:text-gray-200">Reload App Code</span>
                            </button>
                            <div className="h-px bg-gray-200 dark:bg-slate-700 my-1"></div>
                            <button onClick={logout} className="flex items-center gap-3 p-3 rounded hover:bg-gray-100 dark:hover:bg-slate-700 text-left text-red-500 dark:text-red-400">
                                <Icons.Logout />
                                <span className="text-sm">Logout</span>
                            </button>
                        </div>
                    )}

                    {/* Error */}
                    {error && (
                        <div className="m-4 p-3 bg-red-100 dark:bg-red-500/10 border border-red-200 dark:border-red-500/50 rounded flex gap-3 text-red-700 dark:text-red-200 text-sm">
                            <span>{error}</span>
                            <button onClick={() => setError(null)} className="ml-auto font-bold">âœ•</button>
                        </div>
                    )}

                    {/* SHARED CREATE MODAL */}
                    {modalMode && (
                        <div className="modal-bg">
                            <div className="bg-white dark:bg-slate-800 p-6 rounded-xl w-11/12 max-w-sm border border-gray-200 dark:border-slate-700 shadow-2xl text-slate-900 dark:text-white">
                                <h3 className="text-xl font-bold mb-4">{modalMode === 'repo' ? 'New Repository' : 'New File'}</h3>
                                <input 
                                    autoFocus
                                    placeholder={modalMode === 'repo' ? "Repo Name" : "filename.txt"} 
                                    className="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded p-3 mb-4 text-slate-900 dark:text-white focus:border-blue-500 outline-none transition-colors"
                                    value={inputName}
                                    onChange={e => setInputName(e.target.value)}
                                    onKeyDown={handleKeyDown}
                                    autoCapitalize="none"
                                />
                                <div className="flex gap-3">
                                    <button onClick={() => setModalMode(null)} className="flex-1 py-3 text-gray-500 dark:text-gray-400 font-bold bg-gray-100 dark:bg-slate-700 rounded-lg">Cancel</button>
                                    <button onClick={handleCreate} className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg">Create</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Main Content */}
                    <div className="p-4 flex-1 relative">
                        {loading && <div className="absolute inset-0 bg-white/50 dark:bg-slate-900/50 z-10 flex items-start justify-center pt-20"><div className="loader"></div></div>}

                        {/* REPOS VIEW */}
                        {!loading && view === "repos" && (
                            <div className="space-y-4">
                                {repos.map(repo => (
                                    <div key={repo.id} className="bg-white dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 overflow-hidden shadow-sm flex flex-col">
                                        {/* Click to Open Repo */}
                                        <div onClick={() => loadFiles(repo)} className="p-4 border-b border-gray-100 dark:border-slate-700 active:bg-gray-50 dark:active:bg-slate-700 transition cursor-pointer">
                                            <h3 className="font-semibold text-lg text-blue-600 dark:text-blue-100">{repo.name}</h3>
                                            <div className="flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                <span>{repo.private ? "ðŸ”’ Private" : "Public"}</span>
                                                <span>â€¢</span>
                                                <span>{repo.language || "Text"}</span>
                                            </div>
                                        </div>

                                        {/* Action Bar */}
                                        <div className="flex divide-x divide-gray-200 dark:divide-slate-700 bg-gray-50 dark:bg-slate-800/50">
                                            <button onClick={(e) => enablePages(repo, e)} className="flex-1 p-3 flex justify-center items-center text-yellow-600 dark:text-yellow-400 active:bg-gray-200 dark:active:bg-slate-700">
                                                <span className="sr-only">Pages</span>
                                                <Icons.Zap />
                                            </button>
                                            <button onClick={(e) => launchSite(repo, e)} className="flex-1 p-3 flex justify-center items-center text-blue-500 dark:text-blue-400 active:bg-gray-200 dark:active:bg-slate-700">
                                                <span className="sr-only">Launch</span>
                                                <Icons.Globe />
                                            </button>
                                            <button onClick={(e) => deleteRepo(repo, e)} className="flex-1 p-3 flex justify-center items-center text-red-500 dark:text-red-400 active:bg-gray-200 dark:active:bg-slate-700">
                                                <span className="sr-only">Delete</span>
                                                <Icons.Trash />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* FILES VIEW */}
                        {!loading && view === "files" && (
                            <div className="space-y-2">
                                {files.map(file => (
                                    <div key={file.sha} onClick={() => file.type === "dir" ? loadFiles(currentRepo, file.path) : openFile(file)} className="flex items-center gap-3 p-4 bg-white dark:bg-slate-800 rounded-lg border border-gray-200 dark:border-slate-700 active:bg-gray-50 dark:active:bg-slate-700 cursor-pointer shadow-sm">
                                        {file.type === "dir" ? <Icons.Folder /> : <Icons.File />}
                                        <span className="truncate text-sm flex-1 text-slate-700 dark:text-gray-200">{file.name}</span>
                                    </div>
                                ))}
                                {files.length === 0 && <div className="text-center text-gray-400 dark:text-gray-500 mt-10">Empty Directory<br/><small>Click + to create file</small></div>}
                            </div>
                        )}

                        {/* EDITOR VIEW */}
                        {!loading && view === "editor" && (
                            <div className="flex flex-col h-[calc(100vh-140px)]">
                                <textarea 
                                    className="flex-1 bg-gray-50 dark:bg-slate-900 text-slate-900 dark:text-gray-200 p-4 rounded-lg font-mono text-sm border border-gray-300 dark:border-slate-700 resize-none focus:border-blue-500 dark:focus:border-blue-500 transition-colors focus:outline-none"
                                    value={fileContent}
                                    onChange={e => setFileContent(e.target.value)}
                                    spellCheck="false"
                                    placeholder="Type your code here..."
                                ></textarea>
                                <div className="fixed bottom-0 left-0 w-full bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 p-3 flex gap-2 items-center z-50">
                                    <button onClick={handlePaste} className="p-2 text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white"><Icons.Paste /></button>
                                    <button onClick={handleCopy} className="p-2 text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white"><Icons.Copy /></button>
                                    
                                    <input 
                                        value={commitMsg}
                                        onChange={e => setCommitMsg(e.target.value)}
                                        className="flex-1 bg-gray-100 dark:bg-slate-800 text-slate-900 dark:text-white rounded px-3 py-2 text-sm focus:border-blue-500 focus:outline-none ml-1 border border-gray-200 dark:border-slate-700"
                                        placeholder="Commit msg..."
                                    />
                                    <button onClick={saveFile} className="bg-green-600 text-white p-2.5 rounded-lg active:scale-95 transition shadow-lg">
                                        <Icons.Save />
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
